<app-admin-sidebar></app-admin-sidebar>

<div class="admin-layout-content">
  
  <header class="page-header">
    <div>
      <h1>GestiÃ³n de Usuarios</h1>
      <p>Administra accesos y permisos del sistema.</p>
    </div>
    <button class="btn-primary" (click)="openModal('create')">+ Nuevo Usuario</button>
  </header>

  <div class="table-card">
    
    <div class="toolbar">
      <h2 *ngIf="!selectedUser">Directorio de Estudiantes</h2>

      <div class="action-bar" *ngIf="selectedUser">
        <span class="selection-count">1 seleccionado ({{ selectedUser.nombre }})</span>
        <div class="action-buttons">
          <button class="btn-action edit" (click)="openModal('edit')">âœï¸ Editar</button>
          <button class="btn-action delete" (click)="deleteUser()">ğŸ—‘ï¸ Eliminar</button>
          <button class="btn-action close" (click)="selectUser(selectedUser)">âœ•</button>
        </div>
      </div>
    </div>

    <div class="table-responsive">
      <table>
        <thead>
          <tr>
            <th>Nombre</th>
            <th>Email</th>
            <th>Rol</th>
            <th>Estado</th>
          </tr>
        </thead>
        <tbody>
          <tr *ngFor="let u of users" 
              (click)="selectUser(u)" 
              [class.selected]="selectedUser?.id === u.id">
            
            <td><strong>{{ u.nombre }} {{ u.apellidos }}</strong></td>
            <td>{{ u.email }}</td>
            <td><span class="role-badge">{{ u.rol }}</span></td>
            <td>
              <span class="status-dot" [class.active]="u.estado === 'Activo'"></span>
              {{ u.estado }}
            </td>
          </tr>
        </tbody>
      </table>
    </div>
  </div>

</div>


<div class="modal-overlay" *ngIf="isModalOpen">
  <div class="modal-box">
    
    <div class="modal-header">
      <h2>{{ modalMode === 'create' ? 'Crear Nuevo Usuario' : 'Editar Usuario' }}</h2>
      <button class="btn-close-modal" (click)="closeModal()">âœ•</button>
    </div>

    <div class="modal-body">
      <form (ngSubmit)="saveUser()" #userNgForm="ngForm">
        <div class="form-grid">
          
          <div class="input-group">
            <label>Nombre</label>
            <input type="text" name="nombre" [(ngModel)]="userForm.nombre" placeholder="Nombre" required>
          </div>
          
          <div class="input-group">
            <label>Apellidos</label>
            <input type="text" name="apellidos" [(ngModel)]="userForm.apellidos" placeholder="Apellidos" required>
          </div>

          <div class="input-group full-width">
            <label>Email</label>
            <input type="email" name="email" [(ngModel)]="userForm.email" placeholder="nombre@ejemplo.com" required>
          </div>

          <div class="input-group">
            <label>ContraseÃ±a</label>
            <div class="input-with-icon">
              <input [type]="showPassword ? 'text' : 'password'" name="password" [(ngModel)]="userForm.password" placeholder="â€¢â€¢â€¢â€¢â€¢â€¢â€¢â€¢" minlength="8">
              <span class="icon-eye" (click)="togglePasswordVisibility('pass')">
                {{ showPassword ? 'ğŸ‘ï¸' : 'ğŸ•¶ï¸' }}
              </span>
            </div>
            <div class="password-strength">
              <div class="strength-bar" [class.active]="userForm.password.length > 0"></div>
              <div class="strength-bar" [class.active]="userForm.password.length > 5"></div>
              <div class="strength-bar" [class.active]="userForm.password.length >= 8"></div>
              <span class="strength-text">MÃ­nimo 8 caracteres</span>
            </div>
          </div>

          <div class="input-group">
            <label>Repetir contraseÃ±a</label>
            <div class="input-with-icon">
              <input [type]="showConfirmPassword ? 'text' : 'password'" name="confirmPassword" [(ngModel)]="userForm.confirmPassword" placeholder="â€¢â€¢â€¢â€¢â€¢â€¢â€¢â€¢">
              <span class="icon-eye" (click)="togglePasswordVisibility('confirm')">
                {{ showConfirmPassword ? 'ğŸ‘ï¸' : 'ğŸ•¶ï¸' }}
              </span>
            </div>
          </div>

        </div> <div class="modal-footer">
          <button type="button" class="btn-secondary" (click)="closeModal()">Cancelar</button>
          <button type="submit" class="btn-primary" [disabled]="!userNgForm.valid">Guardar</button>
        </div>
      </form>
    </div>

  </div>
</div>